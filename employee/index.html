<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>水果查詢與購買</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin: 20px;
            width: 45%;
            max-width: 500px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
        }

        .form-group label {
            font-size: 16px;
            margin-bottom: 5px;
            color: #555;
        }

        input, select, button {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            width: 60%;
            box-sizing: border-box;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .result {
            margin-top: 20px;
            text-align: center;
        }

        .order-status {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin: 20px;
            width: 45%;
            max-width: 500px;
        }

        .order-list {
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .order-list p {
            font-size: 16px;
            margin: 5px 0;
        }

        .delete-button {
            color: red;
            cursor: pointer;
            font-size: 14px;
        }

        .delete-button:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>水果查詢與購買</h2>
        <p>請選擇水果並輸入購買資訊：</p>

        <div class="form-group">
            <label for="fruit-select">選擇水果：</label>
            <select id="fruit-select">
                <option value="">選擇水果</option>
            </select>
        </div>

        <div class="form-group">
            <label for="purchase-quantity">購買數量：</label>
            <input type="number" id="purchase-quantity" placeholder="購買數量" min="1">
        </div>

        <div class="form-group">
            <label for="delivery-date">預計交運日期：</label>
            <input type="date" id="delivery-date">
        </div>

        <div class="form-group">
            <label for="purchase-price">購買價格（必須高於建議售價*1.5）：</label>
            <input type="number" id="purchase-price" placeholder="輸入購買價格">
        </div>

        <div class="form-group">
            <button onclick="purchaseFruit()">下單</button>
        </div>

        <div class="result" id="result"></div>
    </div>

    <div class="order-status">
        <h2>訂單狀況</h2>
        <p>總金額：<span id="total-amount" class="total">0</span> 元</p>
        <div class="order-list" id="order-list"></div>
    </div>

    <script>
        let fruitDatabase = {
            '001': { name: '蘋果', price: 30, stock: 100 },
            '002': { name: '香蕉', price: 15, stock: 200 },
            '003': { name: '柳橙', price: 25, stock: 150 },
            '004': { name: '葡萄', price: 50, stock: 80 },
            '005': { name: '西瓜', price: 20, stock: 60 }
        };

        let orders = [];
        let totalAmount = 0;

        function updateFruitSelect() {
            const select = document.getElementById('fruit-select');
            select.innerHTML = '<option value="">選擇水果</option>';
            Object.keys(fruitDatabase).forEach(fruitId => {
                const fruit = fruitDatabase[fruitId];
                const salePrice = (fruit.price * 1.5).toFixed(2);
                select.innerHTML += `<option value="${fruitId}">${fruit.name} - 標準售價: $${salePrice} (庫存: ${fruit.stock})</option>`;
            });
        }

        function setDateRestriction() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const minDate = `${year}-${month}-${day}`;
            document.getElementById('delivery-date').setAttribute('min', minDate);
        }

        function purchaseFruit() {
            const fruitId = document.getElementById('fruit-select').value;
            const quantity = parseInt(document.getElementById('purchase-quantity').value);
            const deliveryDate = document.getElementById('delivery-date').value;
            const purchasePrice = parseFloat(document.getElementById('purchase-price').value);

            if (!fruitId || quantity <= 0 || !deliveryDate || purchasePrice <= 0) {
                alert("請填寫完整資訊");
                return;
            }

            const fruit = fruitDatabase[fruitId];
            const salePrice = fruit.price * 1.5;

            if (fruit.stock < quantity) {
                alert("庫存不足");
                return;
            }

            if (purchasePrice < salePrice) {
                alert(`購買價格必須高於標準售價 $${salePrice.toFixed(2)}`);
                return;
            }

            fruit.stock -= quantity;
            const total = purchasePrice * quantity;
            orders.push({ fruit: fruit.name, quantity, purchasePrice, totalAmount: total, deliveryDate });
            totalAmount += total;

            document.getElementById('result').innerHTML =
                `<p>已成功下單：${fruit.name} - ${quantity} 顆，總金額：${total} 元，交運日期：${deliveryDate}</p>`;
            updateOrderStatus();
            updateFruitSelect();
        }

        function updateOrderStatus() {
            const orderListDiv = document.getElementById('order-list');
            orderListDiv.innerHTML = orders.map((order, index) => `
                <p>
                    訂單 ${index + 1}: ${order.fruit} - ${order.quantity} 顆，購買價格: ${order.purchasePrice.toFixed(2)} 元，總金額: ${order.totalAmount} 元，交運日期：${order.deliveryDate}
                    <span class="delete-button" onclick="deleteOrder(${index})">刪除</span>
                </p>
            `).join('');
            document.getElementById('total-amount').textContent = totalAmount;
        }

        function deleteOrder(orderIndex) {
            const order = orders[orderIndex];
            const fruit = Object.values(fruitDatabase).find(f => f.name === order.fruit);

            if (fruit) {
                fruit.stock += order.quantity;
            }

            orders.splice(orderIndex, 1);
            totalAmount -= order.totalAmount;

            updateOrderStatus();
            updateFruitSelect();
        }

        setDateRestriction();
        updateFruitSelect();
    </script>
</body>
</html>